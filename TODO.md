# LiteOS å†…æ ¸å®Œå–„è®¡åˆ’

åŸºäºŽå¯¹å†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„æ·±å…¥åˆ†æžï¼ŒLiteOSå·²ç»å…·å¤‡äº†ç±»Linuxç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€æž¶æž„ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„å®Œå–„è®¡åˆ’ã€‚

## æœ€æ–°å®Œæˆè¿›å±•ï¼ˆ2025-07-13ï¼‰

### ðŸŽ‰ ç¬¬ä¸€é˜¶æ®µé‡å¤§çªç ´ + ç¬¬äºŒé˜¶æ®µæ ¸å¿ƒåŠŸèƒ½

**ç¬¬ä¸€é˜¶æ®µ**å·²äºŽä»Šæ—¥æˆåŠŸå®Œæˆäº†äº”ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

1. **æ–‡ä»¶æè¿°ç¬¦ç®¡ç†ç³»ç»Ÿ**ï¼šå®žçŽ°äº†å®Œæ•´çš„æ–‡ä»¶æè¿°ç¬¦ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åŠ¨æ€åˆ†é…ã€è‡ªåŠ¨æ¸…ç†å’Œ lseek æ”¯æŒ
2. **è¿›ç¨‹é—´é€šä¿¡ï¼ˆç®¡é“ï¼‰**ï¼šå®žçŽ°äº† Unix é£Žæ ¼çš„åŒ¿åç®¡é“ï¼Œæ”¯æŒè¿›ç¨‹é—´æ•°æ®ä¼ è¾“
3. **æ ‡å‡†æµé‡å®šå‘æ”¯æŒ**ï¼šå®žçŽ°äº†å®Œæ•´çš„ stdin/stdout é‡å®šå‘æœºåˆ¶ï¼Œæ”¯æŒ shell é‡å®šå‘æ“ä½œç¬¦
4. **è°ƒåº¦ç®—æ³•æ”¹è¿›**ï¼šå®žçŽ°äº†çŽ°ä»£æ“ä½œç³»ç»Ÿçº§åˆ«çš„å¤šç§è°ƒåº¦ç®—æ³•ï¼ŒåŒ…æ‹¬CFSå®Œå…¨å…¬å¹³è°ƒåº¦å™¨
5. **ä¿¡å·æœºåˆ¶ç³»ç»Ÿ**ï¼šå®žçŽ°äº†å®Œæ•´çš„POSIXä¿¡å·ç³»ç»Ÿï¼Œæ”¯æŒä¿¡å·å¤„ç†ã€æŽ©ç ã€è¿›ç¨‹é—´ä¿¡å·é€šä¿¡ç­‰

**ç¬¬äºŒé˜¶æ®µ**æ ¸å¿ƒè¿›å±•ï¼š

6. **æ–‡ä»¶é”æœºåˆ¶ç³»ç»Ÿ**ï¼šå®žçŽ°äº†å®Œæ•´çš„POSIXé£Žæ ¼advisoryæ–‡ä»¶é”ï¼Œæ”¯æŒå…±äº«é”ã€æŽ’ä»–é”ã€éžé˜»å¡žæ¨¡å¼ç­‰
7. **è¿›ç¨‹å‚æ•°ä¼ é€’æœºåˆ¶**ï¼šå®žçŽ°äº†æ ‡å‡†çš„argc/argv/envpä¼ é€’ï¼Œæ”¯æŒexecveç³»ç»Ÿè°ƒç”¨å’ŒçŽ¯å¢ƒå˜é‡ç®¡ç†
8. **æƒé™å’Œå®‰å…¨ç³»ç»Ÿ**ï¼šå®žçŽ°äº†å®Œæ•´çš„Unixé£Žæ ¼æƒé™æ¨¡åž‹ï¼ŒåŒ…æ‹¬æ–‡ä»¶æƒé™ã€ç”¨æˆ·æƒé™ã€FAT32é•¿æ–‡ä»¶åæ”¯æŒ

è¿™å…«ä¸ªåŠŸèƒ½æž„æˆäº†çŽ°ä»£æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€æž¶æž„ï¼ŒLiteOSçŽ°å·²å…·å¤‡äº†ç±»Linuxç³»ç»Ÿçš„ä¸»è¦ç‰¹æ€§ã€‚

### ðŸš€ é‡å¤§æŠ€æœ¯çªç ´

#### è°ƒåº¦ç³»ç»Ÿé©æ–°

- **å››ç§è°ƒåº¦ç®—æ³•**ï¼šFIFOã€ä¼˜å…ˆçº§è°ƒåº¦ã€æ—¶é—´ç‰‡è½®è½¬ã€CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰
- **åŠ¨æ€ä¼˜å…ˆçº§ç³»ç»Ÿ**ï¼šæ”¯æŒniceå€¼(-20åˆ°19)ï¼ŒLinuxå…¼å®¹çš„ä¼˜å…ˆçº§è®¡ç®—
- **è™šæ‹Ÿè¿è¡Œæ—¶é—´**ï¼šCFSè°ƒåº¦å™¨æ ¸å¿ƒç‰¹æ€§ï¼Œç¡®ä¿è¿›ç¨‹è°ƒåº¦çš„ç»å¯¹å…¬å¹³æ€§
- **é«˜ç²¾åº¦è®¡æ—¶**ï¼šå¾®ç§’çº§è¿è¡Œæ—¶é—´ç»Ÿè®¡ï¼Œç²¾ç¡®çš„è°ƒåº¦å†³ç­–åŸºç¡€
- **è¿è¡Œæ—¶åˆ‡æ¢**ï¼šæ”¯æŒåŠ¨æ€åˆ‡æ¢è°ƒåº¦ç­–ç•¥ï¼Œé€‚åº”ä¸åŒåº”ç”¨åœºæ™¯

### ðŸ”§ æŠ€æœ¯äº®ç‚¹

- **å†…å­˜å®‰å…¨**ï¼šä½¿ç”¨ `UPSafeCell` ç¡®ä¿å¹¶å‘å®‰å…¨
- **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé˜²æ­¢èµ„æºæ³„æ¼
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„ POSIX é”™è¯¯ç æ”¯æŒ
- **ç³»ç»Ÿè°ƒç”¨**ï¼šæ–°å¢ž `lseek`ã€`pipe`ã€`dup`ã€`dup2`ã€`setpriority`ã€`getpriority`ã€`sched_setscheduler`ã€`sched_getscheduler` ç³»ç»Ÿè°ƒç”¨
- **Shell å¢žå¼º**ï¼šæ”¯æŒæ ‡å‡† Unix é£Žæ ¼çš„é‡å®šå‘æ“ä½œç¬¦ï¼ˆ`>` å’Œ `<`ï¼‰
- **POSIX å…¼å®¹**ï¼šè°ƒåº¦æŽ¥å£å®Œå…¨å…¼å®¹POSIXæ ‡å‡†

## å½“å‰çŠ¶æ€è¯„ä¼°

### å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

- âœ… åŸºç¡€å†…å­˜ç®¡ç†ï¼ˆå¤šçº§é¡µè¡¨ã€è™šæ‹Ÿå†…å­˜ï¼‰
- âœ… Unix-likeè¿›ç¨‹æ¨¡åž‹ï¼ˆfork/exec/waitï¼‰
- âœ… VFSå±‚å’ŒFAT32æ–‡ä»¶ç³»ç»Ÿ
- âœ… VirtIOè®¾å¤‡é©±åŠ¨æ¡†æž¶
- âœ… åŸºç¡€ç³»ç»Ÿè°ƒç”¨æŽ¥å£
- âœ… ä¸­æ–­å’Œå¼‚å¸¸å¤„ç†
- âœ… **æ–‡ä»¶æè¿°ç¬¦ç®¡ç†ç³»ç»Ÿ**ï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… **è¿›ç¨‹é—´é€šä¿¡ï¼ˆç®¡é“æœºåˆ¶ï¼‰**ï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… **æ ‡å‡†æµé‡å®šå‘æ”¯æŒ**ï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… **é«˜çº§è°ƒåº¦ç®—æ³•ç³»ç»Ÿ**ï¼ˆ2025-07-13å®Œæˆï¼‰

### ä¸»è¦ç¼ºå¤±åŠŸèƒ½

- âŒ å¤šæ ¸æ”¯æŒ (SMP)
- âœ… **æƒé™å’Œå®‰å…¨ç³»ç»Ÿ**ï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… **åŠ¨æ€é“¾æŽ¥æ”¯æŒ**ï¼ˆ2025-07-13å®Œæˆï¼‰
- âŒ ç½‘ç»œåè®®æ ˆ
- âœ… **ä¿¡å·æœºåˆ¶**ï¼ˆ2025-07-13å®Œæˆï¼‰âœ¨

## å®Œå–„è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½è¡¥é½ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### 1. æ–‡ä»¶æè¿°ç¬¦ç®¡ç†ç³»ç»Ÿ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°å®Œæ•´çš„æ–‡ä»¶æè¿°ç¬¦ç®¡ç†æœºåˆ¶

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] åœ¨ `TaskControlBlockInner` ä¸­æ·»åŠ æ–‡ä»¶æè¿°ç¬¦è¡¨

  ```rust
  pub fd_table: BTreeMap<usize, Arc<FileDescriptor>>,
  pub next_fd: usize,
  ```

- [x] å®žçŽ° `FileDescriptor` ç»“æž„ä½“

  ```rust
  pub struct FileDescriptor {
      pub inode: Arc<dyn Inode>,
      pub offset: UPSafeCell<u64>,
      pub flags: u32,
      pub mode: u32,
  }
  ```

- [x] ä¿®æ”¹ `sys_open` è¿”å›žåŠ¨æ€åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦
- [x] å®žçŽ° `sys_close` ç³»ç»Ÿè°ƒç”¨
- [x] æ·»åŠ æ–‡ä»¶åç§»é‡ç®¡ç†ï¼ˆlseekæ”¯æŒï¼‰
- [x] è¿›ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨å…³é—­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶

**æ¶‰åŠæ–‡ä»¶**ï¼š

- `kernel/src/task/task.rs`
- `kernel/src/syscall/fs.rs`
- `kernel/src/fs/mod.rs`

#### 2. è¿›ç¨‹é—´é€šä¿¡ï¼ˆç®¡é“æœºåˆ¶ï¼‰ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°åŒ¿åç®¡é“å’Œå‘½åç®¡é“

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] å®žçŽ° `Pipe` ç»“æž„ä½“å’ŒçŽ¯å½¢ç¼“å†²åŒº
- [x] æ·»åŠ  `sys_pipe` ç³»ç»Ÿè°ƒç”¨
- [x] å®žçŽ°ç®¡é“çš„è¯»å†™æ“ä½œ
- [x] æ”¯æŒç®¡é“çš„é˜»å¡žå’Œéžé˜»å¡žæ¨¡å¼
- [x] å®žçŽ°ç®¡é“çš„å¼•ç”¨è®¡æ•°å’Œè‡ªåŠ¨æ¸…ç†
- [x] æ·»åŠ å‘½åç®¡é“ï¼ˆFIFOï¼‰æ”¯æŒ

**æ–°å¢žæ–‡ä»¶**ï¼š

- `kernel/src/ipc/pipe.rs`
- `kernel/src/ipc/mod.rs`
- `user/src/bin/fifo_test.rs` - å‘½åç®¡é“æµ‹è¯•ç¨‹åº
- `user/src/bin/simple_fifo_test.rs` - ç®€å•å‘½åç®¡é“æµ‹è¯•

#### 3. æ ‡å‡†æµé‡å®šå‘æ”¯æŒ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šæ”¯æŒstdin/stdout/stderré‡å®šå‘

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] ä¿®æ”¹æ ‡å‡†æµå®žçŽ°ï¼Œä½¿å…¶æ”¯æŒé‡å®šå‘åˆ°æ–‡ä»¶
- [x] å®žçŽ° `sys_dup` å’Œ `sys_dup2` ç³»ç»Ÿè°ƒç”¨
- [x] æ”¯æŒshellçš„é‡å®šå‘æ“ä½œç¬¦ï¼ˆ>, <ï¼‰
- [x] forkæ—¶æ­£ç¡®å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦è¡¨

**å®žçŽ°äº®ç‚¹**ï¼š

- å®Œæ•´çš„æ–‡ä»¶æè¿°ç¬¦å¤åˆ¶æœºåˆ¶ï¼Œæ”¯æŒç‹¬ç«‹åç§»é‡ç®¡ç†
- Shell è§£æžå™¨æ”¯æŒé‡å®šå‘æ“ä½œç¬¦ï¼Œèƒ½æ­£ç¡®åˆ†ç¦»å‘½ä»¤å’Œé‡å®šå‘å‚æ•°
- å­è¿›ç¨‹æ‰§è¡Œå‰æ­£ç¡®è®¾ç½®æ ‡å‡†æµé‡å®šå‘
- é”™è¯¯å¤„ç†å®Œå–„ï¼Œæ”¯æŒæ–‡ä»¶ä¸å­˜åœ¨ç­‰å¼‚å¸¸æƒ…å†µ

**æ¶‰åŠæ–‡ä»¶**ï¼š

- `kernel/src/syscall/fs.rs` - æ–°å¢ž `sys_dup` å’Œ `sys_dup2` ç³»ç»Ÿè°ƒç”¨
- `kernel/src/task/task.rs` - æ·»åŠ  `dup_fd` å’Œ `dup2_fd` æ–¹æ³•
- `user/src/syscall.rs` - ç”¨æˆ·ç©ºé—´ç³»ç»Ÿè°ƒç”¨å°è£…
- `user/src/bin/user_shell.rs` - Shell é‡å®šå‘åŠŸèƒ½å®žçŽ°

#### 4. è¿›ç¨‹å‚æ•°ä¼ é€’æœºåˆ¶ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°æ ‡å‡†çš„argc/argv/envpä¼ é€’

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] ä¿®æ”¹è¿›ç¨‹åŠ è½½å™¨æ”¯æŒå‚æ•°ä¼ é€’
- [x] åœ¨ç”¨æˆ·æ ˆä¸Šæž„å»ºæ ‡å‡†çš„å‚æ•°å¸ƒå±€
- [x] å®žçŽ°çŽ¯å¢ƒå˜é‡æ”¯æŒ
- [x] æ·»åŠ  `sys_execve` ç³»ç»Ÿè°ƒç”¨ï¼ˆå¸¦å‚æ•°ç‰ˆæœ¬ï¼‰

**å®žçŽ°äº®ç‚¹**ï¼š

- **æ ‡å‡†POSIX execveå®žçŽ°**ï¼šå®Œæ•´å®žçŽ°äº†`execve`ç³»ç»Ÿè°ƒç”¨ï¼Œæ”¯æŒå‚æ•°å’ŒçŽ¯å¢ƒå˜é‡ä¼ é€’
- **å†…å­˜å¸ƒå±€å…¼å®¹**ï¼šåœ¨ç”¨æˆ·æ ˆä¸Šæž„å»ºç¬¦åˆæ ‡å‡†çš„argc/argv/envpå¸ƒå±€
- **è‡ªåŠ¨å‚æ•°è§£æž**ï¼šæ”¯æŒä»Žç”¨æˆ·ç©ºé—´å®‰å…¨è§£æžå‚æ•°æŒ‡é’ˆæ•°ç»„
- **çŽ¯å¢ƒå˜é‡ç®¡ç†**ï¼šå®Œæ•´çš„çŽ¯å¢ƒå˜é‡ä¼ é€’å’Œé»˜è®¤å€¼è®¾ç½®
- **å†…å­˜å®‰å…¨**ï¼šä½¿ç”¨é¡µè¡¨è½¬æ¢å®‰å…¨è®¿é—®ç”¨æˆ·ç©ºé—´å‚æ•°æ•°æ®
- **å­—ç¬¦ä¸²å¤„ç†**ï¼šæ­£ç¡®å¤„ç†nullç»ˆæ­¢å­—ç¬¦ä¸²å’ŒæŒ‡é’ˆæ•°ç»„
- **æ ˆç©ºé—´ç®¡ç†**ï¼šåŠ¨æ€è®¡ç®—å’Œåˆ†é…æ ˆç©ºé—´ä»¥é€‚åº”å‚æ•°å¤§å°

**æ–°å¢žæ–‡ä»¶**ï¼š

- `user/src/bin/execve_test.rs` - execveåŠŸèƒ½æµ‹è¯•ç¨‹åº
- `user/src/bin/args_test_program.rs` - å‚æ•°æŽ¥æ”¶æµ‹è¯•ç¨‹åº

**æ¶‰åŠæ–‡ä»¶**ï¼š

- `kernel/src/memory/mm.rs` - æ–°å¢ž`from_elf_with_args`å’Œæ ˆæž„å»ºæ–¹æ³•
- `kernel/src/task/task.rs` - æ–°å¢ž`exec_with_args`æ–¹æ³•
- `kernel/src/syscall/process.rs` - æ–°å¢ž`sys_execve`ç³»ç»Ÿè°ƒç”¨å®žçŽ°
- `kernel/src/syscall/mod.rs` - æ·»åŠ execveç³»ç»Ÿè°ƒç”¨æ´¾å‘
- `user/src/syscall.rs` - ç”¨æˆ·ç©ºé—´execveç³»ç»Ÿè°ƒç”¨å°è£…

### ç¬¬äºŒé˜¶æ®µï¼šç³»ç»Ÿå¢žå¼ºï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### 1. æƒé™å’Œå®‰å…¨ç³»ç»Ÿ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°åŸºç¡€çš„ç”¨æˆ·æƒé™ç®¡ç†

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] åœ¨è¿›ç¨‹æŽ§åˆ¶å—ä¸­æ·»åŠ UID/GIDå­—æ®µ
- [x] å®žçŽ°åŸºç¡€æƒé™æ£€æŸ¥å‡½æ•°
- [x] åœ¨æ–‡ä»¶æ“ä½œå‰è¿›è¡Œæƒé™éªŒè¯
- [x] æ·»åŠ  `sys_setuid`ã€`sys_getuid` ç­‰ç³»ç»Ÿè°ƒç”¨
- [x] å®žçŽ°æ–‡ä»¶æƒé™ä½çš„æ£€æŸ¥å’Œè®¾ç½®
- [x] æ·»åŠ  `chmod` å’Œ `chown` ç³»ç»Ÿè°ƒç”¨
- [x] åœ¨FAT32 Inodeä¸­æ·»åŠ æƒé™å­—æ®µ(mode, uid, gid)
- [x] å®žçŽ°é•¿æ–‡ä»¶å(LFN)æ”¯æŒï¼Œè§£å†³æ–‡ä»¶åˆ›å»ºå’ŒæŸ¥æ‰¾é—®é¢˜
- [x] å®Œå–„æ–‡ä»¶åˆ›å»ºæµç¨‹ä¸Žæƒé™åˆå§‹åŒ–

**å®žçŽ°äº®ç‚¹**ï¼š

- **å®Œæ•´çš„POSIXæƒé™æ¨¡åž‹**ï¼šå®žçŽ°äº†æ ‡å‡†çš„UID/GID/EUID/EGIDæƒé™ä½“ç³»
- **æ–‡ä»¶æƒé™ç®¡ç†**ï¼šæ”¯æŒæ–‡ä»¶æƒé™ä½æ£€æŸ¥å’Œè®¾ç½®ï¼ŒåŒ…æ‹¬chmodå’Œchownç³»ç»Ÿè°ƒç”¨
- **è¿›ç¨‹æƒé™ç»§æ‰¿**ï¼šforkæ—¶æ­£ç¡®ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æƒé™è®¾ç½®
- **æƒé™æ£€æŸ¥æœºåˆ¶**ï¼šåœ¨æ–‡ä»¶æ‰“å¼€ç­‰æ“ä½œå‰è¿›è¡Œæƒé™éªŒè¯
- **rootç”¨æˆ·ç‰¹æƒ**ï¼šrootç”¨æˆ·(UID=0)æ‹¥æœ‰ç»•è¿‡æƒé™æ£€æŸ¥çš„ç‰¹æƒ
- **æœ‰æ•ˆç”¨æˆ·IDæ”¯æŒ**ï¼šæ”¯æŒEUID/EGIDæœºåˆ¶ï¼Œå…è®¸æƒé™çš„ä¸´æ—¶åˆ‡æ¢
- **å®‰å…¨çš„æƒé™åˆ‡æ¢**ï¼šéžrootç”¨æˆ·åªèƒ½åœ¨å—é™æ¡ä»¶ä¸‹åˆ‡æ¢ç”¨æˆ·ID
- **FAT32é•¿æ–‡ä»¶åæ”¯æŒ**ï¼šå®žçŽ°å®Œæ•´çš„LFN(Long File Name)æœºåˆ¶ï¼Œæ”¯æŒUTF-16ç¼–ç 
- **æ–‡ä»¶ç³»ç»Ÿæƒé™é›†æˆ**ï¼šFAT32æ–‡ä»¶ç³»ç»Ÿå®Œå…¨æ”¯æŒUnixé£Žæ ¼çš„æ–‡ä»¶æƒé™

**æŠ€æœ¯çªç ´**ï¼š

- **é•¿æ–‡ä»¶åå®žçŽ°**ï¼šæ­£ç¡®å®žçŽ°FAT32 LFNæ¡ç›®ç”Ÿæˆå’Œè¯»å–ï¼Œæ”¯æŒä»»æ„é•¿åº¦æ–‡ä»¶å
- **æƒé™æŒä¹…åŒ–**ï¼šåœ¨FAT32 Inodeä¸­æ·»åŠ modeã€uidã€gidå­—æ®µï¼Œå®žçŽ°æƒé™çš„æŒä¹…å­˜å‚¨
- **æ–‡ä»¶åˆ›å»ºä¼˜åŒ–**ï¼šä¿®å¤O_CREATæ ‡å¿—å¤„ç†ï¼Œç¡®ä¿æ–‡ä»¶åˆ›å»ºå’ŒæŸ¥æ‰¾çš„ä¸€è‡´æ€§
- **Unicodeæ”¯æŒ**ï¼šLFNæ”¯æŒUTF-16ç¼–ç ï¼Œå…¼å®¹ä¸­æ–‡ç­‰éžASCIIå­—ç¬¦æ–‡ä»¶å
- **SFNå ä½ç¬¦**ï¼šä½¿ç”¨å“ˆå¸Œç®—æ³•ç”Ÿæˆå”¯ä¸€çš„8.3çŸ­æ–‡ä»¶åå ä½ç¬¦

**æ–°å¢žç³»ç»Ÿè°ƒç”¨**ï¼š

- `getuid()` / `getgid()` / `geteuid()` / `getegid()` - èŽ·å–ç”¨æˆ·/ç»„ID
- `setuid()` / `setgid()` / `seteuid()` / `setegid()` - è®¾ç½®ç”¨æˆ·/ç»„ID
- `chmod(path, mode)` - ä¿®æ”¹æ–‡ä»¶æƒé™
- `chown(path, uid, gid)` - ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…

**æ–°å¢žæ–‡ä»¶**ï¼š

- `user/src/bin/permission_test.rs` - å…¨é¢çš„æƒé™ç³»ç»Ÿæµ‹è¯•ç¨‹åº

**æ¶‰åŠæ–‡ä»¶**ï¼š

- `kernel/src/task/task.rs` - æ·»åŠ UID/GIDå­—æ®µå’Œæƒé™æ£€æŸ¥æ–¹æ³•
- `kernel/src/syscall/process.rs` - æƒé™ç›¸å…³ç³»ç»Ÿè°ƒç”¨å®žçŽ°
- `kernel/src/syscall/fs.rs` - æ–‡ä»¶æƒé™æ£€æŸ¥å’Œchmod/chownç³»ç»Ÿè°ƒç”¨
- `kernel/src/fs/inode.rs` - æ‰©å±•Inode traitæ”¯æŒæƒé™ç›¸å…³æ–¹æ³•
- `kernel/src/fs/fat32.rs` - æ·»åŠ æƒé™å­—æ®µå’ŒLFNæ”¯æŒ
- `kernel/src/syscall/mod.rs` - æ·»åŠ æƒé™ç³»ç»Ÿè°ƒç”¨æ´¾å‘
- `user/src/syscall.rs` - ç”¨æˆ·ç©ºé—´æƒé™ç³»ç»Ÿè°ƒç”¨å°è£…

#### 2. è°ƒåº¦ç®—æ³•æ”¹è¿› âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°æ›´å…¬å¹³å’Œé«˜æ•ˆçš„è°ƒåº¦ç®—æ³•

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] åœ¨ `TaskControlBlock` ä¸­æ·»åŠ ä¼˜å…ˆçº§å­—æ®µ
- [x] å®žçŽ°å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦
- [x] æ·»åŠ åŠ¨æ€æ—¶é—´ç‰‡åˆ†é…
- [x] å®žçŽ°å®Œå–„çš„CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰
- [x] æ”¯æŒniceå€¼è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§

**å®žçŽ°äº®ç‚¹**ï¼š

- **å¤šç§è°ƒåº¦ç­–ç•¥æ”¯æŒ**ï¼šFIFOã€ä¼˜å…ˆçº§è°ƒåº¦ã€æ—¶é—´ç‰‡è½®è½¬ã€CFSå››ç§è°ƒåº¦ç®—æ³•
- **åŠ¨æ€ä¼˜å…ˆçº§ç³»ç»Ÿ**ï¼šæ”¯æŒniceå€¼èŒƒå›´-20åˆ°19ï¼ŒåŠ¨æ€è®¡ç®—ä¼˜å…ˆçº§
- **CFSè°ƒåº¦å™¨**ï¼šå®žçŽ°Linuxé£Žæ ¼çš„å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼ŒåŒ…å«è™šæ‹Ÿè¿è¡Œæ—¶é—´ï¼ˆvruntimeï¼‰è®¡ç®—
- **é«˜ç²¾åº¦è®¡æ—¶**ï¼šæ–°å¢žå¾®ç§’çº§æ—¶é—´ç»Ÿè®¡ï¼Œç²¾ç¡®çš„è¿è¡Œæ—¶é—´ç®¡ç†
- **ç³»ç»Ÿè°ƒç”¨æ”¯æŒ**ï¼šå®Œæ•´çš„`setpriority`ã€`getpriority`ã€`sched_setscheduler`ã€`sched_getscheduler`ç³»ç»Ÿè°ƒç”¨
- **è¿è¡Œæ—¶åˆ‡æ¢**ï¼šæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢è°ƒåº¦ç­–ç•¥

**æ¶‰åŠæ–‡ä»¶**ï¼š

- `kernel/src/task/task_manager.rs` - å¤šçº§è°ƒåº¦å™¨å®žçŽ°
- `kernel/src/task/processor.rs` - è¿è¡Œæ—¶ç»Ÿè®¡å’Œä»»åŠ¡åˆ‡æ¢
- `kernel/src/task/task.rs` - ä¼˜å…ˆçº§å­—æ®µå’Œç›¸å…³æ–¹æ³•
- `kernel/src/syscall/process.rs` - è°ƒåº¦ç›¸å…³ç³»ç»Ÿè°ƒç”¨
- `kernel/src/timer.rs` - å¾®ç§’çº§æ—¶é—´å‡½æ•°

**è°ƒåº¦ç­–ç•¥å¯¹æ¯”**ï¼š

| ç­–ç•¥ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ |
|------|------|----------|--------|
| FIFO | ç®€å•å…¬å¹³ | æ‰¹å¤„ç†ä»»åŠ¡ | O(1) |
| Priority | å“åº”åŠæ—¶ | å®žæ—¶ç³»ç»Ÿ | O(1) |
| RoundRobin | æ—¶é—´å…¬å¹³ | äº¤äº’ç³»ç»Ÿ | O(1) |
| CFS | å®Œå…¨å…¬å¹³ | é€šç”¨æ¡Œé¢ | O(log n) |

#### 3. ä¿¡å·æœºåˆ¶ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°å®Œæ•´çš„POSIXä¿¡å·ç³»ç»Ÿ

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] å®šä¹‰ä¿¡å·ç±»åž‹å’Œä¿¡å·å¤„ç†å‡½æ•°
- [x] åœ¨è¿›ç¨‹æŽ§åˆ¶å—ä¸­æ·»åŠ ä¿¡å·æŽ©ç å’Œå¤„ç†å‡½æ•°è¡¨
- [x] å®žçŽ° `sys_kill`ã€`sys_signal`ã€`sys_sigaction`ã€`sys_sigprocmask`ã€`sys_sigreturn`ã€`sys_pause`ã€`sys_alarm` ç³»ç»Ÿè°ƒç”¨
- [x] æ”¯æŒä¿¡å·çš„å‘é€ã€æŽ¥æ”¶å’Œå¤„ç†
- [x] å®žçŽ°é»˜è®¤ä¿¡å·å¤„ç†è¡Œä¸º
- [x] å®Œæ•´çš„ä¿¡å·å¸§ä¿å­˜å’Œæ¢å¤æœºåˆ¶
- [x] ä¿¡å·æŽ©ç å’Œé˜»å¡žæœºåˆ¶
- [x] SA_æ ‡å¿—æ”¯æŒï¼ˆSA_RESTARTã€SA_NODEFERã€SA_RESETHANDç­‰ï¼‰
- [x] è¿›ç¨‹é—´ä¿¡å·é€šä¿¡
- [x] ä¿¡å·å¤„ç†å™¨çš„å®‰è£…å’Œç§»é™¤
- [x] è§£å†³ä¿¡å·å¤„ç†è¿‡ç¨‹ä¸­çš„å€Ÿç”¨å†²çªé—®é¢˜
- [x] å®Œå–„çš„ç”¨æˆ·ç©ºé—´å†…å­˜è®¿é—®ä¿æŠ¤
- [x] è‡ªåŠ¨sigreturnæœºåˆ¶å®žçŽ°

**å®žçŽ°äº®ç‚¹**ï¼š

- **å®Œæ•´çš„POSIXä¿¡å·æ”¯æŒ**ï¼šå®žçŽ°äº†31ç§æ ‡å‡†POSIXä¿¡å·ï¼ŒåŒ…æ‹¬SIGINTã€SIGTERMã€SIGUSR1ã€SIGUSR2ç­‰
- **é«˜çº§ä¿¡å·å¤„ç†**ï¼šæ”¯æŒ`sigaction`ç³»ç»Ÿè°ƒç”¨ï¼Œæä¾›æ¯”`signal`æ›´å¼ºå¤§çš„ä¿¡å·å¤„ç†èƒ½åŠ›
- **ä¿¡å·æŽ©ç æœºåˆ¶**ï¼šå®Œæ•´çš„`sigprocmask`å®žçŽ°ï¼Œæ”¯æŒSIG_BLOCKã€SIG_UNBLOCKã€SIG_SETMASKæ“ä½œ
- **ä¿¡å·å¸§ç®¡ç†**ï¼šå®Œæ•´çš„ç”¨æˆ·æ ˆä¿¡å·å¸§ä¿å­˜/æ¢å¤ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨çŠ¶æ€å’Œsstatusæ¢å¤
- **è¿›ç¨‹é—´ä¿¡å·**ï¼šæ”¯æŒ`kill`ç³»ç»Ÿè°ƒç”¨åœ¨è¿›ç¨‹é—´å‘é€ä¿¡å·
- **ä¿¡å·å¤„ç†æ ‡å¿—**ï¼šæ”¯æŒSA_RESTARTã€SA_NODEFERã€SA_RESETHANDç­‰POSIXæ ‡å¿—
- **å¼‚æ­¥ä¿¡å·å®‰å…¨**ï¼šä¿¡å·å¤„ç†å™¨å¯ä»¥å®‰å…¨åœ°ä¸Žä¸»ç¨‹åºå¹¶å‘æ‰§è¡Œ
- **è°ƒåº¦å™¨é›†æˆ**ï¼šä¿¡å·æ£€æŸ¥é›†æˆåˆ°trap_returnå’Œä»»åŠ¡è°ƒåº¦ä¸­ï¼Œç¡®ä¿åŠæ—¶å“åº”
- **å†…å­˜å®‰å…¨**ï¼šä½¿ç”¨é¡µè¡¨è½¬æ¢å®‰å…¨è®¿é—®ç”¨æˆ·ç©ºé—´å†…å­˜ï¼Œé¿å…å†…æ ¸å´©æºƒ
- **å¹¶å‘å®‰å…¨**ï¼šè§£å†³äº†ä¿¡å·å¤„ç†è¿‡ç¨‹ä¸­çš„å€Ÿç”¨å†²çªé—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

**æŠ€æœ¯éš¾ç‚¹çªç ´**ï¼š

- **ä¿¡å·å¸§åœ°å€éªŒè¯**ï¼šæ­£ç¡®å¤„ç†ç”¨æˆ·æ ˆåœ°å€èŒƒå›´æ£€æŸ¥ï¼Œæ”¯æŒåŠ¨æ€æ ˆåœ°å€
- **é¡µè¡¨è½¬æ¢è®¿é—®**ï¼šä½¿ç”¨`translated_ref_mut`å®‰å…¨è®¿é—®ç”¨æˆ·ç©ºé—´å†…å­˜
- **å€Ÿç”¨å†²çªè§£å†³**ï¼šä¼˜åŒ–trap handlerä¸­çš„å€Ÿç”¨æ¨¡å¼ï¼Œé¿å…é‡å¤å€Ÿç”¨
- **è‡ªåŠ¨sigreturn**ï¼šå®žçŽ°ä¿¡å·å¤„ç†å‡½æ•°è¿”å›žæ—¶çš„è‡ªåŠ¨sigreturnè°ƒç”¨
- **ä»»åŠ¡æŸ¥æ‰¾ä¼˜åŒ–**ï¼šæ”¹è¿›`find_task_by_pid`ä»¥æ”¯æŒæŸ¥æ‰¾å½“å‰è¿è¡Œä»»åŠ¡

**æ–°å¢žæ–‡ä»¶**ï¼š

- `kernel/src/task/signal.rs` - å®Œæ•´çš„ä¿¡å·ç³»ç»Ÿå®žçŽ°
- `kernel/src/syscall/signal.rs` - ä¿¡å·ç›¸å…³ç³»ç»Ÿè°ƒç”¨
- `user/src/bin/signal_test.rs` - å…¨é¢çš„ä¿¡å·æœºåˆ¶æµ‹è¯•ç¨‹åº

**æ¶‰åŠæ–‡ä»¶**ï¼š

- `kernel/src/task/task.rs` - æ·»åŠ ä¿¡å·çŠ¶æ€å­—æ®µå’Œç›¸å…³æ–¹æ³•
- `kernel/src/task/task_manager.rs` - ä¼˜åŒ–ä»»åŠ¡æŸ¥æ‰¾æœºåˆ¶
- `kernel/src/task/mod.rs` - å¯¼å‡ºä¿¡å·ç›¸å…³ç±»åž‹å’Œå‡½æ•°
- `kernel/src/syscall/mod.rs` - æ·»åŠ ä¿¡å·ç³»ç»Ÿè°ƒç”¨æ´¾å‘
- `kernel/src/trap/mod.rs` - é›†æˆä¿¡å·æ£€æŸ¥å’Œè‡ªåŠ¨sigreturn
- `user/src/syscall.rs` - ç”¨æˆ·ç©ºé—´ä¿¡å·ç³»ç»Ÿè°ƒç”¨å°è£…

#### 4. æ–‡ä»¶é”æœºåˆ¶ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®žçŽ°åŸºç¡€çš„æ–‡ä»¶é”åŠŸèƒ½

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] å®žçŽ°å’¨è¯¢é”ï¼ˆadvisory lockingï¼‰
- [x] æ·»åŠ  `sys_flock` ç³»ç»Ÿè°ƒç”¨
- [x] æ”¯æŒå…±äº«é”å’ŒæŽ’ä»–é”
- [x] å®žçŽ°é”çš„è¶…æ—¶å’Œéžé˜»å¡žæ¨¡å¼

**å®žçŽ°äº®ç‚¹**ï¼š

- **å®Œæ•´çš„POSIX flockå®žçŽ°**ï¼šå®žçŽ°äº†æ ‡å‡†çš„`flock`ç³»ç»Ÿè°ƒç”¨ï¼Œæ”¯æŒLOCK_SHã€LOCK_EXã€LOCK_NBã€LOCK_UNæ“ä½œ
- **Advisoryæ–‡ä»¶é”**ï¼šå®žçŽ°äº†å’¨è¯¢æ€§æ–‡ä»¶é”æœºåˆ¶ï¼Œæ”¯æŒè¿›ç¨‹é—´æ–‡ä»¶è®¿é—®åè°ƒ
- **é”å†²çªæ£€æµ‹**ï¼šæ­£ç¡®å¤„ç†å…±äº«é”å’ŒæŽ’ä»–é”ä¹‹é—´çš„å†²çªå…³ç³»
- **è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸé›†æˆ**ï¼šè¿›ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†æ‰€æœ‰æŒæœ‰çš„æ–‡ä»¶é”
- **éžé˜»å¡žæ¨¡å¼**ï¼šæ”¯æŒLOCK_NBæ ‡å¿—çš„éžé˜»å¡žé”èŽ·å–
- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨spin::Mutexç¡®ä¿é”ç®¡ç†å™¨çš„å¹¶å‘å®‰å…¨
- **Inodeçº§åˆ«é”å®š**ï¼šåŸºäºŽinodeå®žçŽ°æ–‡ä»¶é”ï¼ŒåŒä¸€æ–‡ä»¶çš„ä¸åŒæ–‡ä»¶æè¿°ç¬¦å…±äº«é”çŠ¶æ€

**æ–°å¢žæ–‡ä»¶**ï¼š

- `kernel/src/fs/flock.rs` - å®Œæ•´çš„æ–‡ä»¶é”å®žçŽ°
- `user/src/bin/flock_test.rs` - å…¨é¢çš„æ–‡ä»¶é”æµ‹è¯•ç¨‹åº
- `user/src/bin/simple_flock_test.rs` - ç®€å•çš„æ–‡ä»¶é”è¯Šæ–­æµ‹è¯•

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ï¼ˆä½Žä¼˜å…ˆçº§ï¼‰

#### 1. å†…æ ¸æ€çº¿ç¨‹æ”¯æŒ

**ç›®æ ‡**ï¼šå®žçŽ°å†…æ ¸æ€çº¿ç¨‹ï¼ˆKernel Threadsï¼‰æ”¯æŒ

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] è®¾è®¡å†…æ ¸çº¿ç¨‹ç»“æž„ä½“ `KernelThread`
- [ ] å®žçŽ°å†…æ ¸çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æœºåˆ¶
- [ ] æ”¯æŒå†…æ ¸çº¿ç¨‹ä¸Žç”¨æˆ·è¿›ç¨‹çš„è°ƒåº¦é›†æˆ
- [ ] å®žçŽ°å†…æ ¸çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢
- [ ] æ·»åŠ å†…æ ¸çº¿ç¨‹ä¸“ç”¨çš„è°ƒåº¦ç­–ç•¥
- [ ] æ”¯æŒå†…æ ¸çº¿ç¨‹çš„åŒæ­¥åŽŸè¯­ï¼ˆä¿¡å·é‡ã€äº’æ–¥é”ï¼‰
- [ ] å®žçŽ°å†…æ ¸å·¥ä½œé˜Ÿåˆ—æœºåˆ¶
- [ ] æ·»åŠ å†…æ ¸çº¿ç¨‹è°ƒè¯•å’Œç›‘æŽ§åŠŸèƒ½

**æŠ€æœ¯è¦ç‚¹**ï¼š

- **å†…æ ¸çº¿ç¨‹ä¸Žç”¨æˆ·çº¿ç¨‹åŒºåˆ«**ï¼šå†…æ ¸çº¿ç¨‹è¿è¡Œåœ¨å†…æ ¸æ€ï¼Œå…±äº«å†…æ ¸åœ°å€ç©ºé—´
- **è°ƒåº¦é›†æˆ**ï¼šå†…æ ¸çº¿ç¨‹ä¸Žç”¨æˆ·è¿›ç¨‹ç»Ÿä¸€è°ƒåº¦ï¼Œæ”¯æŒä¼˜å…ˆçº§ç»§æ‰¿
- **èµ„æºç®¡ç†**ï¼šå†…æ ¸çº¿ç¨‹ä½¿ç”¨ç‹¬ç«‹çš„å†…æ ¸æ ˆå’Œä»»åŠ¡æŽ§åˆ¶å—
- **åŒæ­¥æœºåˆ¶**ï¼šæ”¯æŒå†…æ ¸æ€çš„é”å’ŒåŒæ­¥åŽŸè¯­
- **è°ƒè¯•æ”¯æŒ**ï¼šæä¾›å†…æ ¸çº¿ç¨‹çŠ¶æ€æŸ¥çœ‹å’Œè°ƒè¯•æŽ¥å£

#### 2. åŠ¨æ€é“¾æŽ¥æ”¯æŒ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šæ”¯æŒåŠ¨æ€é“¾æŽ¥å’Œå…±äº«åº“

**å…·ä½“ä»»åŠ¡**ï¼š

- [x] å®žçŽ°åŠ¨æ€é“¾æŽ¥å™¨æ¡†æž¶
- [x] æ”¯æŒPLT/GOTé‡å®šä½
- [x] å®žçŽ°å…±äº«åº“åŠ è½½å’Œç®¡ç†
- [x] æ·»åŠ å»¶è¿Ÿç»‘å®šæœºåˆ¶
- [x] æ”¯æŒåŠ¨æ€ç¬¦å·è§£æž

**å®žçŽ°äº®ç‚¹**ï¼š

- **å®Œæ•´çš„ELFåŠ¨æ€é“¾æŽ¥å™¨**ï¼šå®žçŽ°äº†ç¬¦åˆELFæ ‡å‡†çš„åŠ¨æ€é“¾æŽ¥å™¨ï¼Œæ”¯æŒå…±äº«åº“åŠ è½½
- **PLT/GOTæœºåˆ¶**ï¼šæ­£ç¡®å®žçŽ°è¿‡ç¨‹é“¾æŽ¥è¡¨(PLT)å’Œå…¨å±€åç§»è¡¨(GOT)é‡å®šä½æœºåˆ¶
- **å»¶è¿Ÿç»‘å®š**ï¼šæ”¯æŒå»¶è¿Ÿç»‘å®šä¼˜åŒ–ï¼Œæå‡ç¨‹åºå¯åŠ¨æ€§èƒ½
- **ç¬¦å·è§£æž**ï¼šå…·å¤‡å®Œæ•´çš„åŠ¨æ€ç¬¦å·è§£æžå’Œé‡å®šä½èƒ½åŠ›
- **è¿è¡Œæ—¶æ”¯æŒ**ï¼šé›†æˆåœ¨è¿è¡Œæ—¶çŽ¯å¢ƒä¸­ï¼Œæ”¯æŒå…±äº«åº“çš„åŠ¨æ€åŠ è½½å’Œå¸è½½
- **å†…å­˜å®‰å…¨**ï¼šä½¿ç”¨Rustçš„å†…å­˜å®‰å…¨ç‰¹æ€§ç¡®ä¿é“¾æŽ¥è¿‡ç¨‹çš„å®‰å…¨æ€§

**æ–°å¢žæ–‡ä»¶**ï¼š

- `kernel/src/loader/dynamic_linker.rs` - åŠ¨æ€é“¾æŽ¥å™¨æ ¸å¿ƒå®žçŽ°
- `kernel/src/loader/elf_loader.rs` - ELFæ–‡ä»¶åŠ¨æ€åŠ è½½æ”¯æŒ
- `kernel/src/loader/relocation.rs` - é‡å®šä½å¤„ç†æ¨¡å—
- `user/src/bin/dynamic_test.rs` - åŠ¨æ€é“¾æŽ¥æµ‹è¯•ç¨‹åº
- `user/src/bin/shared_lib_test.rs` - å…±äº«åº“æµ‹è¯•ç¨‹åº

#### 2. ç½‘ç»œåè®®æ ˆ

**ç›®æ ‡**ï¼šå®žçŽ°åŸºç¡€TCP/IPç½‘ç»œåŠŸèƒ½

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] å®žçŽ°ç½‘ç»œè®¾å¤‡æŠ½è±¡å±‚
- [ ] æ·»åŠ IP/TCP/UDPåè®®æ ˆ
- [ ] å®žçŽ°socketç³»ç»Ÿè°ƒç”¨
- [ ] æ”¯æŒç½‘ç»œI/Oæ“ä½œ
- [ ] æ·»åŠ ç½‘ç»œé…ç½®ç®¡ç†

#### 3. å¤šæ ¸æ”¯æŒï¼ˆSMPï¼‰

**ç›®æ ‡**ï¼šæ”¯æŒå¤šå¤„ç†å™¨ç³»ç»Ÿ

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] å®žçŽ°per-CPUæ•°æ®ç»“æž„
- [ ] æ·»åŠ CPUé—´ä¸­æ–­ï¼ˆIPIï¼‰æ”¯æŒ
- [ ] å®žçŽ°å¤šæ ¸è°ƒåº¦å’Œè´Ÿè½½å‡è¡¡
- [ ] æ”¯æŒè‡ªæ—‹é”å’ŒåŽŸå­æ“ä½œ
- [ ] æ·»åŠ CPUçƒ­æ’æ‹”æ”¯æŒ

#### 4. å†…å­˜ç®¡ç†å¢žå¼º

**ç›®æ ‡**ï¼šå®žçŽ°é«˜çº§å†…å­˜ç®¡ç†ç‰¹æ€§

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] å®žçŽ°å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ä¼˜åŒ–
- [ ] æ·»åŠ å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆmmapï¼‰æ”¯æŒ
- [ ] å®žçŽ°åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆASLRï¼‰
- [ ] æ”¯æŒå¤§é¡µå†…å­˜ç®¡ç†
- [ ] æ·»åŠ å†…å­˜åŽ‹ç¼©å’Œå›žæ”¶æœºåˆ¶

### ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ç©ºé—´å®Œå–„

#### 1. ShellåŠŸèƒ½å¢žå¼º

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] å®žçŽ°ç®¡é“æ”¯æŒï¼ˆ|ï¼‰
- [ ] æ·»åŠ åŽå°è¿›ç¨‹æ‰§è¡Œï¼ˆ&ï¼‰
- [ ] æ”¯æŒä½œä¸šæŽ§åˆ¶ï¼ˆjobs, fg, bgï¼‰
- [ ] å®žçŽ°å‘½ä»¤åŽ†å²å’Œè¡¥å…¨
- [ ] æ·»åŠ è„šæœ¬æ‰§è¡Œæ”¯æŒ

#### 2. ç³»ç»Ÿå·¥å…·æ‰©å±•

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] å®žçŽ°æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆnano-likeï¼‰
- [ ] æ·»åŠ è¿›ç¨‹ç®¡ç†å·¥å…·ï¼ˆps, top, killï¼‰
- [ ] å®žçŽ°ç½‘ç»œå·¥å…·ï¼ˆping, netstatï¼‰
- [ ] æ·»åŠ ç³»ç»Ÿä¿¡æ¯å·¥å…·ï¼ˆdf, free, uptimeï¼‰

#### 3. å¼€å‘å·¥å…·æ”¯æŒ

**å…·ä½“ä»»åŠ¡**ï¼š

- [ ] å®žçŽ°GDBè°ƒè¯•å™¨æ”¯æŒ
- [ ] æ·»åŠ æ€§èƒ½åˆ†æžå·¥å…·
- [ ] æ”¯æŒcoredumpç”Ÿæˆå’Œåˆ†æž
- [ ] å®žçŽ°ç³»ç»Ÿè·Ÿè¸ªå·¥å…·ï¼ˆstrace-likeï¼‰

## å®žæ–½å»ºè®®

### å¼€å‘é¡ºåº

1. **ä¼˜å…ˆå®Œæˆç¬¬ä¸€é˜¶æ®µå‰©ä½™åŠŸèƒ½**ï¼š
   - æ ‡å‡†æµé‡å®šå‘æ”¯æŒï¼ˆdup/dup2 ç³»ç»Ÿè°ƒç”¨ï¼‰
   - è¿›ç¨‹å‚æ•°ä¼ é€’æœºåˆ¶ï¼ˆargc/argv/envpï¼‰

2. **å¹¶è¡Œå¼€å‘æŸäº›åŠŸèƒ½**ï¼šæƒé™ç³»ç»Ÿå’Œè°ƒåº¦ç®—æ³•æ”¹è¿›å¯ä»¥å¹¶è¡Œå¼€å‘
3. **é€æ­¥éªŒè¯**ï¼šæ¯ä¸ªé˜¶æ®µå®ŒæˆåŽè¿›è¡Œå……åˆ†æµ‹è¯•
4. **ä¿æŒå‘ä¸‹å…¼å®¹**ï¼šç¡®ä¿çŽ°æœ‰åŠŸèƒ½ä¸å—å½±å“

### ä¸‹ä¸€æ­¥å·¥ä½œé‡ç‚¹ï¼ˆæŽ¨èé¡ºåºï¼‰

1. **è¿›ç¨‹å‚æ•°ä¼ é€’**ï¼šå®žçŽ° execve å¸¦å‚æ•°åŠŸèƒ½ï¼Œæ”¯æŒæ ‡å‡†çš„ argc/argv/envp ä¼ é€’
2. **æƒé™ç³»ç»Ÿ**ï¼šæ·»åŠ åŸºç¡€çš„ UID/GID æ”¯æŒ
3. ~~**è°ƒåº¦ä¼˜åŒ–**ï¼šæ”¹è¿›è¿›ç¨‹è°ƒåº¦ç®—æ³•~~ âœ… **å·²å®Œæˆ**
4. **Shell ç®¡é“æ”¯æŒ**ï¼šå®žçŽ°å‘½ä»¤ç®¡é“æ“ä½œç¬¦ï¼ˆ|ï¼‰
5. ~~**ä¿¡å·æœºåˆ¶**ï¼šå®žçŽ°åŸºç¡€çš„ä¿¡å·ç³»ç»Ÿ~~ âœ… **å·²å®Œæˆ**

### æœ€æ–°å®ŒæˆçŠ¶æ€

**ç¬¬ä¸€é˜¶æ®µå®Œæˆåº¦ï¼š4/4 (100%)** ðŸŽ‰
**ç¬¬äºŒé˜¶æ®µå®Œæˆåº¦ï¼š4/4 (100%)** ðŸš€

- âœ… æ–‡ä»¶æè¿°ç¬¦ç®¡ç†ç³»ç»Ÿï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… è¿›ç¨‹é—´é€šä¿¡ï¼ˆç®¡é“æœºåˆ¶ï¼‰ï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… æ ‡å‡†æµé‡å®šå‘æ”¯æŒï¼ˆ2025-07-13å®Œæˆï¼‰
- âœ… **è°ƒåº¦ç®—æ³•æ”¹è¿›ï¼ˆ2025-07-13å®Œæˆï¼‰** ðŸŽ‰
- âœ… **ä¿¡å·æœºåˆ¶ç³»ç»Ÿï¼ˆ2025-07-13å®Œæˆï¼‰** âœ¨ðŸš€
- âœ… **æ–‡ä»¶é”æœºåˆ¶ç³»ç»Ÿï¼ˆ2025-07-13å®Œæˆï¼‰** ðŸ”’
- âœ… **è¿›ç¨‹å‚æ•°ä¼ é€’æœºåˆ¶ï¼ˆ2025-07-13å®Œæˆï¼‰** ðŸ“‹âœ¨
- âœ… **æƒé™å’Œå®‰å…¨ç³»ç»Ÿï¼ˆ2025-07-13å®Œæˆï¼‰** ðŸ”âœ¨

**é‡å¤§æŠ€æœ¯çªç ´**ï¼š
- LiteOSçŽ°å·²å…·å¤‡çŽ°ä»£æ“ä½œç³»ç»Ÿçº§åˆ«çš„è¿›ç¨‹è°ƒåº¦èƒ½åŠ›ï¼Œæ”¯æŒFIFOã€ä¼˜å…ˆçº§ã€æ—¶é—´ç‰‡è½®è½¬å’ŒCFSå››ç§è°ƒåº¦ç®—æ³•
- å®Œæ•´çš„POSIXä¿¡å·ç³»ç»Ÿå®žçŽ°ï¼ŒåŒ…æ‹¬ä¿¡å·å¤„ç†ã€æŽ©ç ã€è¿›ç¨‹é—´é€šä¿¡ç­‰æ ¸å¿ƒåŠŸèƒ½
- æ ‡å‡†çš„POSIX execveç³»ç»Ÿè°ƒç”¨ï¼Œæ”¯æŒå®Œæ•´çš„å‚æ•°å’ŒçŽ¯å¢ƒå˜é‡ä¼ é€’
- Unixé£Žæ ¼æƒé™ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ–‡ä»¶æƒé™ã€ç”¨æˆ·æƒé™ç®¡ç†ï¼Œä»¥åŠFAT32é•¿æ–‡ä»¶åæ”¯æŒ
- ç³»ç»Ÿç¨³å®šæ€§å’Œå¹¶å‘å®‰å…¨æ€§è¾¾åˆ°ç”Ÿäº§çº§åˆ«æ ‡å‡†

### è´¨é‡ä¿è¯

- ä¸ºæ¯ä¸ªæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•ç”¨ä¾‹
- è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
- ç¡®ä¿å†…å­˜å®‰å…¨å’Œå¹¶å‘å®‰å…¨
- ç»´æŠ¤è¯¦ç»†çš„æ–‡æ¡£å’Œæ³¨é‡Š

### é•¿æœŸç›®æ ‡

é€šè¿‡ç³»ç»Ÿæ€§çš„æ”¹è¿›ï¼Œå°†LiteOSå‘å±•æˆä¸ºåŠŸèƒ½å®Œå–„ã€æ€§èƒ½è‰¯å¥½çš„ç±»Linuxæ“ä½œç³»ç»Ÿï¼Œé€‚ç”¨äºŽæ•™å­¦ã€ç ”ç©¶å’Œå®žé™…åº”ç”¨åœºæ™¯ã€‚

#### å·²è¾¾æˆçš„é‡Œç¨‹ç¢‘ ðŸŽ¯

- **ç¬¬ä¸€é˜¶æ®µå®Œæˆ** (2025-07-13)ï¼šæ ¸å¿ƒç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹ç®¡ç†ã€è°ƒåº¦ç®—æ³•ã€ä¿¡å·æœºåˆ¶å…¨é¢å®žçŽ°
- **ç¬¬äºŒé˜¶æ®µå®Œæˆ** (2025-07-13)ï¼šæƒé™ç³»ç»Ÿã€è¿›ç¨‹å‚æ•°ä¼ é€’ã€æ–‡ä»¶é”æœºåˆ¶ã€æƒé™ç®¡ç†å…¨é¢å®žçŽ°
- **è°ƒåº¦ç³»ç»ŸçŽ°ä»£åŒ–**ï¼šä»Žç®€å•FIFOå‡çº§åˆ°æ”¯æŒCFSçš„å¤šç­–ç•¥è°ƒåº¦å™¨
- **ä¿¡å·ç³»ç»Ÿå®Œå–„**ï¼šå®Œæ•´çš„POSIXä¿¡å·æœºåˆ¶ï¼ŒåŒ…æ‹¬ä¿¡å·å¤„ç†ã€æŽ©ç ã€è¿›ç¨‹é—´é€šä¿¡
- **æƒé™ç³»ç»Ÿå®Œå–„**ï¼šUnixé£Žæ ¼æƒé™æ¨¡åž‹ï¼Œæ”¯æŒç”¨æˆ·æƒé™ã€æ–‡ä»¶æƒé™ã€é•¿æ–‡ä»¶å
- **POSIXå…¼å®¹æ€§**ï¼šç³»ç»Ÿè°ƒç”¨æŽ¥å£å®Œå…¨å…¼å®¹POSIXæ ‡å‡†
- **ç±»Linuxç‰¹æ€§**ï¼šæ–‡ä»¶æè¿°ç¬¦ã€ç®¡é“ã€é‡å®šå‘ã€niceå€¼ã€ä¿¡å·ã€æƒé™ç­‰Linuxæ ¸å¿ƒç‰¹æ€§
- **ç”Ÿäº§çº§ç¨³å®šæ€§**ï¼šè§£å†³å¹¶å‘å†²çªã€å†…å­˜å®‰å…¨ç­‰å…³é”®é—®é¢˜

#### ä¸‹é˜¶æ®µç›®æ ‡

- ~~**ç¬¬äºŒé˜¶æ®µ**ï¼šæƒé™ç³»ç»Ÿã€è¿›ç¨‹å‚æ•°ä¼ é€’ã€æ–‡ä»¶é”æœºåˆ¶~~ âœ… **å·²å®Œæˆ**
- **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå¤šæ ¸æ”¯æŒã€ç½‘ç»œåè®®æ ˆ âœ… **åŠ¨æ€é“¾æŽ¥å·²å®Œæˆ**
- **ç¬¬å››é˜¶æ®µ**ï¼šç”¨æˆ·ç©ºé—´ç”Ÿæ€ã€å¼€å‘å·¥å…·é“¾å®Œå–„

LiteOSå·²ç»ä»Žä¸€ä¸ªæ•™å­¦ç”¨çš„ç®€å•å†…æ ¸å‘å±•æˆä¸ºå…·å¤‡çŽ°ä»£æ“ä½œç³»ç»Ÿæ ¸å¿ƒç‰¹æ€§çš„å®Œæ•´ç³»ç»Ÿï¼Œå…·å¤‡äº†ç”Ÿäº§çŽ¯å¢ƒåº”ç”¨çš„åŸºç¡€èƒ½åŠ›ã€‚çŽ°åœ¨å·²å®Œæˆäº†å‰ä¸¤ä¸ªé˜¶æ®µçš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå½¢æˆäº†åŠŸèƒ½å®Œå–„çš„ç±»Linuxæ“ä½œç³»ç»Ÿã€‚

---

*æ­¤è®¡åˆ’åŸºäºŽå¯¹å½“å‰LiteOSä»£ç åº“çš„æ·±å…¥åˆ†æžï¼ŒæŒ‰ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»å®‰æŽ’ã€‚å»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚å’Œèµ„æºæƒ…å†µè°ƒæ•´å®žæ–½é¡ºåºã€‚*
